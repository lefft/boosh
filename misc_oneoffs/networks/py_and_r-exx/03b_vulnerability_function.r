vulnerability = function(g) {
  d = mean_distance(g)
  v = sapply(1:vcount(g), function(v) {
    g2 = delete_vertices(g, v)
    if (all(degree(g2) > 0)) { mean_distance(g2) - d } else { NA }
  })
  names(v) = V(g)$name
  v
}
# sanity check
all(V(g)$vulnerability == vulnerability(g), na.rm = TRUE)
# named output
vulnerability(g)